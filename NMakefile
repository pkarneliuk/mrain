PROGRAM	= mrain

!IFDEF DEBUG
# Debug configuration
CPPFLAGS= /nologo /W4 /EHsc /TP /c /wd4201 /wd4995 /arch:SSE /Od /MTd /ZI /Fd"out\vc90.pdb"
DEFINES	= /DWIN32 /D_CONSOLE /D_CRT_SECURE_NO_WARNINGS /D_DEBUG
LINKFLAGS=/DEBUG /PDB:"d:\sources\out\mrain.pdb" /MANIFEST:NO /NOLOGO /SUBSYSTEM:WINDOWS
!ELSE
# Release configuration
CPPFLAGS= /nologo /W4 /EHsc /TP /c /wd4201 /wd4995 /GL /arch:SSE /Ox /MT
DEFINES	= /DWIN32 /D_CONSOLE /D_CRT_SECURE_NO_WARNINGS /DNDEBUG
LINKFLAGS=/LTCG:STATUS /MANIFEST:NO /NOLOGO /SUBSYSTEM:WINDOWS
!ENDIF

INCLUDES= /I "." /I ".\win"
LIBS	= kernel32.lib user32.lib Opengl32.lib Gdi32.lib ole32.lib shell32.lib Strmiids.lib


PROJ_FILES	= *.cpp *.h Makefile devlog license nix win
PUBLIC_NAME	= MatrixRain
PACK_NAME	= $(PROGRAM)-0.0.`date +%G%m%d`
DESTDIR 	=

INSTALL_BIN_DIR	= %SystemRoot%\system32\


all: $(PROGRAM).exe

clean:
	-rmdir /S /Q out
	-del mrain* *~

$(PROGRAM).exe: $(OBJ) out\resources.res
	link.exe /OUT:out\$@ $(LINKFLAGS) $** $(LIBS)

{.}.cpp{out}.obj::
	@if not exist out mkdir out
	cl.exe $(CPPFLAGS) $(INCLUDES) $(DEFINES) -Fo"out/" $<

{win}.cpp{out}.obj::
	@if not exist out mkdir out
	cl.exe $(CPPFLAGS) $(INCLUDES) $(DEFINES) -Fo"out/" $<

out\resources.res: win\resources.rc
	@if not exist out mkdir out
	rc.exe /fo$@ $**

install: $(PROGRAM).exe
	copy /B out\$(PROGRAM).exe $(INSTALL_BIN_DIR)\$(PROGRAM).scr

uninstall:
	del /Q /F $(INSTALL_BIN_DIR)\$(PROGRAM).scr
